import 'dart:io';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:cloudinary_public/cloudinary_public.dart';
import '../models/language.dart';
import 'package:flutter/material.dart';
import 'package:firebase_storage/firebase_storage.dart';

class LanguageService {
  final FirebaseFirestore _firestore = FirebaseFirestore.instance;
  final cloudinary = CloudinaryPublic('daav4neoy', 'ml_default', cache: false);

  // R√©cup√©rer toutes les langues
  Stream<List<Language>> getLanguages() {
    return _firestore.collection('languages').snapshots().map((snapshot) =>
        snapshot.docs.map((doc) => Language.fromFirestore(doc)).toList());
  }

  // R√©cup√©rer une langue sp√©cifique
  Future<Language?> getLanguage(String languageId) async {
    final doc = await _firestore.collection('languages').doc(languageId).get();
    return doc.exists ? Language.fromFirestore(doc) : null;
  }

  // Uploader une image vers Cloudinary
  Future<String> uploadImage(File image, String languageCode) async {
    try {
      CloudinaryResponse response = await cloudinary.uploadFile(
        CloudinaryFile.fromFile(
          image.path,
          folder: 'language_flags',
          resourceType: CloudinaryResourceType.Image,
        ),
      );
      return response.secureUrl;
    } catch (e) {
      print('Erreur lors de l\'upload de l\'image: $e');
      rethrow;
    }
  }

  // Initialiser les langues dans Firebase
  Future<void> initializeLanguages() async {
    try {
      // Fran√ßais
      final frenchRef = _firestore.collection('languages').doc('french');
      await frenchRef.set({
        'name': 'Fran√ßais',
        'code': 'fr',
        'flag': 'üá´üá∑',
        'description': 'Apprenez le fran√ßais avec des le√ßons interactives',
        'level': 'D√©butant'
      });

      // Cr√©er les cat√©gories pour le fran√ßais
      final frenchCategories = [
        {
          'name': 'Les bases',
          'description': 'Commencez votre apprentissage avec les fondamentaux',
          'order': 1,
          'lessons': [
            {
              'title': 'L\'alphabet et la prononciation',
              'description':
                  'Ma√Ætrisez l\'alphabet fran√ßais et ses sons uniques pour une prononciation parfaite',
              'duration': 20,
              'xp': 50,
              'level': 'A1',
              'content': [
                {
                  'type': 'text',
                  'value':
                      'L\'alphabet fran√ßais comporte 26 lettres, comme l\'alphabet latin.'
                },
                {
                  'type': 'image',
                  'url': 'assets/images/french/alphabet.jpg',
                  'caption': 'L\'alphabet fran√ßais'
                },
                {
                  'type': 'audio',
                  'url': 'assets/audio/french/alphabet.mp3',
                  'caption': '√âcoutez la prononciation de l\'alphabet'
                }
              ],
              'vocabulary': {
                'title': 'L\'alphabet',
                'words': [
                  {
                    'word': 'A [a]',
                    'translation': 'comme dans "chat"',
                    'example': 'ami, table, papa',
                    'image': 'assets/images/french/vocabulary/ami.jpg',
                    'audio': 'assets/audio/french/vocabulary/a.mp3'
                  },
                  {
                    'word': 'E […ô]',
                    'translation': 'comme dans "le"',
                    'example': 'petit, demain, je',
                    'image': 'assets/images/french/vocabulary/petit.jpg',
                    'audio': 'assets/audio/french/vocabulary/e.mp3'
                  }
                ]
              },
              'questions': [
                {
                  'type': 'multiple_choice',
                  'question':
                      'Quelle est la prononciation correcte de la lettre "E" ?',
                  'options': ['[a]', '[…ô]', '[i]', '[o]'],
                  'correctAnswer': 1,
                  'explanation': 'La lettre "E" se prononce […ô] comme dans "le"'
                },
                {
                  'type': 'audio_recognition',
                  'question': '√âcoutez et choisissez la lettre correspondante',
                  'audio': 'assets/audio/french/questions/letter_a.mp3',
                  'options': ['A', 'E', 'I', 'O'],
                  'correctAnswer': 0
                }
              ],
              'exercises': [
                {
                  'type': 'pronunciation',
                  'title': 'R√©p√©tez apr√®s l\'audio',
                  'items': [
                    {
                      'text': 'bonjour',
                      'audio': 'assets/audio/french/exercises/bonjour.mp3',
                      'image': 'assets/images/french/exercises/bonjour.jpg'
                    }
                  ]
                }
              ]
            },
            {
              'title': 'Les salutations',
              'description':
                  'Apprenez √† saluer et √† vous pr√©senter en fran√ßais',
              'duration': 25,
              'xp': 75,
              'level': 'A1',
              'content': [
                {
                  'type': 'text',
                  'value':
                      'Les salutations sont essentielles dans la culture fran√ßaise.'
                },
                {
                  'type': 'image',
                  'url': 'assets/images/french/greetings.jpg',
                  'caption': 'Les diff√©rentes fa√ßons de se saluer en fran√ßais'
                },
                {
                  'type': 'video',
                  'url': 'assets/videos/french/greetings.mp4',
                  'caption': 'Regardez comment les Fran√ßais se saluent'
                }
              ],
              'vocabulary': {
                'title': 'Les salutations',
                'words': [
                  {
                    'word': 'Bonjour',
                    'translation': 'Hello',
                    'context': 'Formel, utilis√© toute la journ√©e',
                    'example': 'Bonjour, comment allez-vous ?',
                    'image': 'assets/images/french/vocabulary/bonjour.jpg',
                    'audio': 'assets/audio/french/vocabulary/bonjour.mp3'
                  }
                ]
              },
              'questions': [
                {
                  'type': 'multiple_choice',
                  'question': 'Quelle salutation est formelle ?',
                  'options': ['Salut', 'Bonjour', 'Coucou', 'Hey'],
                  'correctAnswer': 1,
                  'explanation':
                      'Bonjour est la salutation formelle standard en fran√ßais'
                },
                {
                  'type': 'image_matching',
                  'question': 'Associez l\'image √† la bonne salutation',
                  'images': [
                    'assets/images/french/questions/formal_greeting.jpg',
                    'assets/images/french/questions/casual_greeting.jpg'
                  ],
                  'options': ['Bonjour', 'Salut'],
                  'correctAnswers': [0, 1]
                }
              ]
            }
          ]
        },
        {
          'name': 'Voyage et H√©bergement',
          'description': 'Apprenez √† communiquer pendant vos voyages',
          'order': 3,
          'lessons': [
            {
              'title': '√Ä l\'h√¥tel',
              'description':
                  'Vocabulaire et expressions utiles pour s√©journer √† l\'h√¥tel',
              'duration': 30,
              'xp': 75,
              'level': 'A2',
              'content': [
                'Faire une r√©servation',
                'Check-in et check-out',
                'Les services de l\'h√¥tel'
              ],
              'vocabulary': {
                'title': 'Vocabulaire de l\'h√¥tel',
                'words': [
                  {
                    'word': 'R√©servation',
                    'translation': 'Booking',
                    'example': 'Je voudrais faire une r√©servation.',
                    'audioFile': 'audio/hotel/reservation.mp3',
                    'hasAudio': true,
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Chambre simple',
                    'translation': 'Single room',
                    'example': 'Je souhaite une chambre simple.',
                    'audioFile': 'audio/hotel/chambre_simple.mp3',
                    'hasAudio': true,
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Service de chambre',
                    'translation': 'Room service',
                    'example': 'Puis-je commander le service de chambre ?',
                    'audioFile': 'audio/hotel/service_chambre.mp3',
                    'hasAudio': true,
                    'icon': Icons.volume_up
                  }
                ]
              },
              'completed': false,
              'progress': 0
            }
          ]
        },
        {
          'name': 'Nourriture et Restaurant',
          'description':
              'D√©couvrez la gastronomie fran√ßaise et apprenez √† commander au restaurant',
          'order': 2,
          'lessons': [
            {
              'title': 'Au restaurant',
              'description':
                  'Ma√Ætrisez l\'art de commander et de d√Æner dans un restaurant fran√ßais',
              'duration': 35,
              'xp': 80,
              'level': 'A2',
              'content': [
                {
                  'type': 'text',
                  'value':
                      'La gastronomie fran√ßaise est c√©l√®bre dans le monde entier.'
                },
                {
                  'type': 'image',
                  'url': 'assets/images/french/restaurant.jpg',
                  'caption': 'Un restaurant fran√ßais typique'
                },
                {
                  'type': 'video',
                  'url': 'assets/videos/french/ordering.mp4',
                  'caption': 'Comment commander dans un restaurant fran√ßais'
                }
              ],
              'vocabulary': {
                'title': 'Au restaurant',
                'words': [
                  {
                    'word': 'Le menu',
                    'translation': 'The menu',
                    'example': 'Puis-je voir le menu, s\'il vous pla√Æt ?',
                    'image': 'assets/images/french/vocabulary/menu.jpg',
                    'audio': 'assets/audio/french/vocabulary/menu.mp3'
                  },
                  {
                    'word': 'L\'addition',
                    'translation': 'The bill',
                    'example': 'L\'addition, s\'il vous pla√Æt.',
                    'image': 'assets/images/french/vocabulary/addition.jpg',
                    'audio': 'assets/audio/french/vocabulary/addition.mp3'
                  }
                ]
              },
              'questions': [
                {
                  'type': 'role_play',
                  'scenario': 'Commander un repas',
                  'roles': ['Client', 'Serveur'],
                  'dialogue': [
                    {'role': 'Serveur', 'text': 'Bonjour, vous avez choisi ?'},
                    {'role': 'Client', 'text': 'Je voudrais...'}
                  ],
                  'image': 'assets/images/french/questions/restaurant_scene.jpg'
                },
                {
                  'type': 'menu_ordering',
                  'question': 'Composez un repas fran√ßais typique',
                  'options': {
                    'entr√©es': ['Soupe √† l\'oignon', 'Salade ni√ßoise'],
                    'plats': ['Coq au vin', 'Boeuf bourguignon'],
                    'desserts': ['Cr√®me br√ªl√©e', 'Tarte Tatin']
                  },
                  'images': {
                    'Soupe √† l\'oignon':
                        'assets/images/french/dishes/onion_soup.jpg',
                    'Salade ni√ßoise':
                        'assets/images/french/dishes/nicoise_salad.jpg',
                    'Coq au vin': 'assets/images/french/dishes/coq_au_vin.jpg',
                    'Boeuf bourguignon':
                        'assets/images/french/dishes/beef_bourguignon.jpg',
                    'Cr√®me br√ªl√©e':
                        'assets/images/french/dishes/creme_brulee.jpg',
                    'Tarte Tatin': 'assets/images/french/dishes/tarte_tatin.jpg'
                  }
                }
              ]
            }
          ]
        },
        {
          'name': 'Vie quotidienne',
          'description': 'Le vocabulaire de tous les jours',
          'order': 2,
          'lessons': [
            {
              'title': '√Ä l\'h√¥tel',
              'description':
                  'Vocabulaire et expressions pour s√©journer √† l\'h√¥tel',
              'duration': '30 min',
              'xp': 80,
              'level': 'A2',
              'vocabulary_theme': {
                'title': 'Vocabulaire h√¥telier',
                'words': [
                  {
                    'word': 'R√©servation',
                    'translation': 'Booking',
                    'example': 'Je voudrais faire une r√©servation',
                    'audio': 'assets/audio/french/reservation.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Chambre simple',
                    'translation': 'Single room',
                    'example': 'Je voudrais une chambre simple',
                    'audio': 'assets/audio/french/chambre_simple.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Chambre double',
                    'translation': 'Double room',
                    'example': 'Avez-vous une chambre double ?',
                    'audio': 'assets/audio/french/chambre_double.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Service de chambre',
                    'translation': 'Room service',
                    'example': 'J\'aimerais commander le service de chambre',
                    'audio': 'assets/audio/french/service_chambre.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Petit-d√©jeuner',
                    'translation': 'Breakfast',
                    'example': 'Le petit-d√©jeuner est inclus ?',
                    'audio': 'assets/audio/french/petit_dejeuner.mp3',
                    'icon': Icons.volume_up
                  }
                ]
              },
              'dialogues': [
                {
                  'title': '√Ä la r√©ception',
                  'conversation': [
                    {
                      'speaker': 'Client',
                      'text': 'Bonjour, j\'ai une r√©servation au nom de Martin',
                      'audio': 'assets/audio/french/hotel_dialogue1.mp3',
                      'icon': Icons.volume_up
                    },
                    {
                      'speaker': 'R√©ceptionniste',
                      'text':
                          'Bienvenue ! Oui, une chambre double pour 3 nuits ?',
                      'audio': 'assets/audio/french/hotel_dialogue2.mp3',
                      'icon': Icons.volume_up
                    }
                  ]
                }
              ]
            },
            {
              'title': 'Au restaurant',
              'description': 'Commander et d√Æner au restaurant',
              'duration': '35 min',
              'xp': 90,
              'level': 'A2',
              'vocabulary_theme': {
                'title': 'Vocabulaire de restaurant',
                'words': [
                  {
                    'word': 'Menu',
                    'translation': 'Menu',
                    'example': 'Puis-je voir le menu ?',
                    'audio': 'assets/audio/french/menu.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Entr√©e',
                    'translation': 'Starter',
                    'example': 'Comme entr√©e, je prendrai la soupe',
                    'audio': 'assets/audio/french/entree.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Plat principal',
                    'translation': 'Main course',
                    'example': 'Quel est le plat du jour ?',
                    'audio': 'assets/audio/french/plat_principal.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Dessert',
                    'translation': 'Dessert',
                    'example': 'Je voudrais le dessert du jour',
                    'audio': 'assets/audio/french/dessert.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'L\'addition',
                    'translation': 'The bill',
                    'example': 'L\'addition, s\'il vous pla√Æt',
                    'audio': 'assets/audio/french/addition.mp3',
                    'icon': Icons.volume_up
                  }
                ]
              }
            }
          ]
        },
        {
          'name': 'Transport',
          'description': 'Se d√©placer en ville et en voyage',
          'order': 3,
          'lessons': [
            {
              'title': 'Les transports en commun',
              'description': 'Vocabulaire pour utiliser les transports publics',
              'duration': '25 min',
              'xp': 70,
              'level': 'A2',
              'vocabulary_theme': {
                'title': 'Vocabulaire des transports',
                'words': [
                  {
                    'word': 'M√©tro',
                    'translation': 'Subway',
                    'example': 'Quelle ligne de m√©tro pour la Tour Eiffel ?',
                    'audio': 'assets/audio/french/metro.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Bus',
                    'translation': 'Bus',
                    'example': '√Ä quelle heure passe le prochain bus ?',
                    'audio': 'assets/audio/french/bus.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Train',
                    'translation': 'Train',
                    'example': 'Le train est √† l\'heure ?',
                    'audio': 'assets/audio/french/train.mp3',
                    'icon': Icons.volume_up
                  },
                  {
                    'word': 'Billet',
                    'translation': 'Ticket',
                    'example': 'O√π puis-je acheter un billet ?',
                    'audio': 'assets/audio/french/billet.mp3',
                    'icon': Icons.volume_up
                  }
                ]
              }
            }
          ]
        }
      ];

      // Ajouter les cat√©gories √† la sous-collection
      for (var category in frenchCategories) {
        await frenchRef.collection('categories').add(category);
      }

      // Anglais
      final englishRef = _firestore.collection('languages').doc('english');
      await englishRef.set({
        'name': 'English',
        'code': 'en',
        'flag': 'üá¨üáß',
        'description': 'Learn English',
      });

      // Cr√©er les cat√©gories pour l'anglais
      final englishCategories = [
        {
          'name': 'Basics',
          'description': 'Learn the fundamentals of English',
          'order': 1,
          'lessons': [
            {
              'title': 'The Alphabet',
              'description': 'Learn the English alphabet',
              'duration': '15 min',
              'xp': 50,
              'level': 'A1',
              'content': 'A, B, C, D...',
              'completed': false,
              'progress': 0.0
            }
          ]
        },
        {
          'name': 'Daily Life',
          'description': 'Everyday vocabulary',
          'order': 2,
          'lessons': [
            {
              'title': 'Greetings',
              'description': 'Learn how to greet people',
              'duration': '20 min',
              'xp': 75,
              'level': 'A1',
              'content': 'Hello, Goodbye...',
              'completed': false,
              'progress': 0.0
            }
          ]
        }
      ];

      // Ajouter les cat√©gories √† la sous-collection
      for (var category in englishCategories) {
        await englishRef.collection('categories').add(category);
      }
    } catch (e) {
      print('Erreur lors de l\'initialisation des langues: $e');
      rethrow;
    }
  }

  List<Map<String, dynamic>> _getLessonsForCategory(
      String langId, String categoryId) {
    // D√©finition des le√ßons par cat√©gorie et par langue
    final Map<String, Map<String, List<Map<String, dynamic>>>>
        lessonsPerCategory = {
      'basics': {
        'fr': [
          {
            'id': 'greetings',
            'title': 'Les salutations',
            'duration': 15,
            'xp': 20,
            'level': 'A1',
            'content': 'Apprenez √† saluer en fran√ßais'
          },
          {
            'id': 'introductions',
            'title': 'Se pr√©senter',
            'duration': 20,
            'xp': 25,
            'level': 'A1',
            'content': 'Apprenez √† vous pr√©senter en fran√ßais'
          },
          {
            'id': 'numbers',
            'title': 'Les nombres et l\'alphabet',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Ma√Ætrisez les nombres et l\'alphabet fran√ßais'
          }
        ],
        'en': [
          {
            'id': 'greetings',
            'title': 'Greetings',
            'duration': 15,
            'xp': 20,
            'level': 'A1',
            'content': 'Learn how to greet people in English'
          },
          {
            'id': 'introductions',
            'title': 'Introducing Yourself',
            'duration': 20,
            'xp': 25,
            'level': 'A1',
            'content': 'Learn how to introduce yourself in English'
          },
          {
            'id': 'numbers',
            'title': 'Numbers and Alphabet',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Master English numbers and alphabet'
          }
        ],
        'ar': [
          {
            'id': 'greetings',
            'title': 'ÿßŸÑÿ™ÿ≠Ÿäÿßÿ™',
            'duration': 15,
            'xp': 20,
            'level': 'A1',
            'content': 'ÿ™ÿπŸÑŸÖ ŸÉŸäŸÅŸäÿ© ÿ•ŸÑŸÇÿßÿ° ÿßŸÑÿ™ÿ≠Ÿäÿ© ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'
          },
          {
            'id': 'introductions',
            'title': 'ÿ™ŸÇÿØŸäŸÖ ÿßŸÑŸÜŸÅÿ≥',
            'duration': 20,
            'xp': 25,
            'level': 'A1',
            'content': 'ÿ™ÿπŸÑŸÖ ŸÉŸäŸÅŸäÿ© ÿ™ŸÇÿØŸäŸÖ ŸÜŸÅÿ≥ŸÉ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'
          },
          {
            'id': 'numbers',
            'title': 'ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ŸàÿßŸÑÿ≠ÿ±ŸàŸÅ',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'ÿ™ÿπŸÑŸÖ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ŸàÿßŸÑÿ≠ÿ±ŸàŸÅ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'
          }
        ],
        'it': [
          {
            'id': 'greetings',
            'title': 'I saluti',
            'duration': 15,
            'xp': 20,
            'level': 'A1',
            'content': 'Impara a salutare in italiano'
          },
          {
            'id': 'introductions',
            'title': 'Presentarsi',
            'duration': 20,
            'xp': 25,
            'level': 'A1',
            'content': 'Impara a presentarti in italiano'
          },
          {
            'id': 'numbers',
            'title': 'Numeri e alfabeto',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Impara i numeri e l\'alfabeto italiano'
          }
        ],
        'de': [
          {
            'id': 'greetings',
            'title': 'Begr√º√üungen',
            'duration': 15,
            'xp': 20,
            'level': 'A1',
            'content': 'Lernen Sie, auf Deutsch zu gr√º√üen'
          },
          {
            'id': 'introductions',
            'title': 'Sich vorstellen',
            'duration': 20,
            'xp': 25,
            'level': 'A1',
            'content': 'Lernen Sie, sich auf Deutsch vorzustellen'
          },
          {
            'id': 'numbers',
            'title': 'Zahlen und Alphabet',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Lernen Sie die deutschen Zahlen und das Alphabet'
          }
        ]
      },
      'food': {
        'fr': [
          {
            'id': 'restaurant',
            'title': 'Au restaurant',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'Commander au restaurant en fran√ßais'
          },
          {
            'id': 'cuisine',
            'title': 'La cuisine fran√ßaise',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'D√©couvrez la gastronomie fran√ßaise'
          },
          {
            'id': 'recipes',
            'title': 'Recettes et ingr√©dients',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Apprenez √† lire et comprendre les recettes fran√ßaises'
          }
        ],
        'en': [
          {
            'id': 'restaurant',
            'title': 'At the Restaurant',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'Order food at a restaurant in English'
          },
          {
            'id': 'cuisine',
            'title': 'British Cuisine',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Discover British gastronomy'
          },
          {
            'id': 'recipes',
            'title': 'Recipes and Ingredients',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Learn to read and understand English recipes'
          }
        ],
        'ar': [
          {
            'id': 'restaurant',
            'title': 'ŸÅŸä ÿßŸÑŸÖÿ∑ÿπŸÖ',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'ÿ™ÿπŸÑŸÖ ŸÉŸäŸÅŸäÿ© ÿßŸÑÿ∑ŸÑÿ® ŸÅŸä ÿßŸÑŸÖÿ∑ÿπŸÖ'
          },
          {
            'id': 'cuisine',
            'title': 'ÿßŸÑŸÖÿ∑ÿ®ÿÆ ÿßŸÑÿπÿ±ÿ®Ÿä',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'ÿßŸÉÿ™ÿ¥ŸÅ ÿßŸÑŸÖÿ£ŸÉŸàŸÑÿßÿ™ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑÿ™ŸÇŸÑŸäÿØŸäÿ©'
          },
          {
            'id': 'recipes',
            'title': 'ÿßŸÑŸàÿµŸÅÿßÿ™ ŸàÿßŸÑŸÖŸÉŸàŸÜÿßÿ™',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'ÿ™ÿπŸÑŸÖ ŸÇÿ±ÿßÿ°ÿ© ŸàŸÅŸáŸÖ ÿßŸÑŸàÿµŸÅÿßÿ™ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'
          }
        ],
        'it': [
          {
            'id': 'restaurant',
            'title': 'Al ristorante',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'Ordinare al ristorante in italiano'
          },
          {
            'id': 'cuisine',
            'title': 'La cucina italiana',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Scopri la gastronomia italiana'
          },
          {
            'id': 'recipes',
            'title': 'Ricette e ingredienti',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Impara a leggere e capire le ricette italiane'
          }
        ],
        'de': [
          {
            'id': 'restaurant',
            'title': 'Im Restaurant',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'Im Restaurant bestellen'
          },
          {
            'id': 'cuisine',
            'title': 'Deutsche K√ºche',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Entdecken Sie die deutsche K√ºche'
          },
          {
            'id': 'recipes',
            'title': 'Rezepte und Zutaten',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Lernen Sie deutsche Rezepte zu lesen und zu verstehen'
          }
        ]
      },
      'culture': {
        'fr': [
          {
            'id': 'traditions',
            'title': 'Traditions fran√ßaises',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'D√©couvrez les traditions fran√ßaises'
          },
          {
            'id': 'festivals',
            'title': 'F√™tes et festivals',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'Les c√©l√©brations importantes en France'
          },
          {
            'id': 'arts',
            'title': 'Arts et litt√©rature',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Explorez la culture artistique fran√ßaise'
          }
        ],
        'en': [
          {
            'id': 'traditions',
            'title': 'British Traditions',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'Learn about British traditions'
          },
          {
            'id': 'festivals',
            'title': 'Festivals and Celebrations',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'Important celebrations in British culture'
          },
          {
            'id': 'arts',
            'title': 'Arts and Literature',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Explore British arts and literature'
          }
        ],
        'ar': [
          {
            'id': 'traditions',
            'title': 'ÿßŸÑÿ™ŸÇÿßŸÑŸäÿØ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'ÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ™ŸÇÿßŸÑŸäÿØ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'
          },
          {
            'id': 'festivals',
            'title': 'ÿßŸÑÿ£ÿπŸäÿßÿØ ŸàÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑÿßÿ™',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ© ŸÅŸä ÿßŸÑÿ´ŸÇÿßŸÅÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'
          },
          {
            'id': 'arts',
            'title': 'ÿßŸÑŸÅŸÜŸàŸÜ ŸàÿßŸÑÿ£ÿØÿ®',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'ÿßŸÉÿ™ÿ¥ŸÅ ÿßŸÑŸÅŸÜŸàŸÜ ŸàÿßŸÑÿ£ÿØÿ® ÿßŸÑÿπÿ±ÿ®Ÿä'
          }
        ],
        'it': [
          {
            'id': 'traditions',
            'title': 'Tradizioni italiane',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'Scopri le tradizioni italiane'
          },
          {
            'id': 'festivals',
            'title': 'Feste e festival',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'Le celebrazioni importanti in Italia'
          },
          {
            'id': 'arts',
            'title': 'Arte e letteratura',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Esplora l\'arte e la letteratura italiana'
          }
        ],
        'de': [
          {
            'id': 'traditions',
            'title': 'Deutsche Traditionen',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'Lernen Sie deutsche Traditionen kennen'
          },
          {
            'id': 'festivals',
            'title': 'Feste und Festivals',
            'duration': 25,
            'xp': 30,
            'level': 'A2',
            'content': 'Wichtige Feiern in der deutschen Kultur'
          },
          {
            'id': 'arts',
            'title': 'Kunst und Literatur',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Entdecken Sie deutsche Kunst und Literatur'
          }
        ]
      },
      'work': {
        'fr': [
          {
            'id': 'interview',
            'title': 'Entretien d\'embauche',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Pr√©parez votre entretien en fran√ßais'
          },
          {
            'id': 'office',
            'title': 'Au bureau',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'Le vocabulaire professionnel'
          },
          {
            'id': 'meetings',
            'title': 'R√©unions professionnelles',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Participez efficacement aux r√©unions'
          }
        ],
        'en': [
          {
            'id': 'interview',
            'title': 'Job Interview',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Prepare for your job interview'
          },
          {
            'id': 'office',
            'title': 'Office Life',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'Professional vocabulary and office communication'
          },
          {
            'id': 'meetings',
            'title': 'Business Meetings',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Participate effectively in meetings'
          }
        ],
        'ar': [
          {
            'id': 'interview',
            'title': 'ŸÖŸÇÿßÿ®ŸÑÿ© ÿßŸÑÿπŸÖŸÑ',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ± ŸÑŸÖŸÇÿßÿ®ŸÑÿ© ÿßŸÑÿπŸÖŸÑ'
          },
          {
            'id': 'office',
            'title': 'ŸÅŸä ÿßŸÑŸÖŸÉÿ™ÿ®',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ ÿßŸÑŸÖŸáŸÜŸäÿ© ŸàÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÅŸä ÿßŸÑÿπŸÖŸÑ'
          },
          {
            'id': 'meetings',
            'title': 'ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπÿßÿ™ ÿßŸÑŸÖŸáŸÜŸäÿ©',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÅÿπÿßŸÑÿ© ŸÅŸä ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπÿßÿ™'
          }
        ],
        'it': [
          {
            'id': 'interview',
            'title': 'Colloquio di lavoro',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Preparati per il tuo colloquio di lavoro'
          },
          {
            'id': 'office',
            'title': 'In ufficio',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'Vocabolario professionale e comunicazione in ufficio'
          },
          {
            'id': 'meetings',
            'title': 'Riunioni di lavoro',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Partecipa efficacemente alle riunioni'
          }
        ],
        'de': [
          {
            'id': 'interview',
            'title': 'Vorstellungsgespr√§ch',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Bereiten Sie sich auf Ihr Vorstellungsgespr√§ch vor'
          },
          {
            'id': 'office',
            'title': 'Im B√ºro',
            'duration': 30,
            'xp': 35,
            'level': 'B1',
            'content': 'Beruflicher Wortschatz und B√ºrokommunikation'
          },
          {
            'id': 'meetings',
            'title': 'Gesch√§ftsbesprechungen',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Nehmen Sie effektiv an Besprechungen teil'
          }
        ]
      },
      'daily_life': {
        'fr': [
          {
            'id': 'routine',
            'title': 'Routine quotidienne',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Apprendre √† d√©crire sa routine quotidienne'
          },
          {
            'id': 'shopping',
            'title': 'Faire les courses',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Vocabulaire et expressions pour le shopping'
          },
          {
            'id': 'hobbies',
            'title': 'Loisirs et temps libre',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Parler de ses hobbies et activit√©s'
          }
        ],
        'en': [
          {
            'id': 'routine',
            'title': 'Daily Routine',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Learn to describe your daily routine'
          },
          {
            'id': 'shopping',
            'title': 'Shopping',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Vocabulary and expressions for shopping'
          },
          {
            'id': 'hobbies',
            'title': 'Hobbies and Free Time',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Talk about your hobbies and activities'
          }
        ],
        'ar': [
          {
            'id': 'routine',
            'title': 'ÿßŸÑÿ±Ÿàÿ™ŸäŸÜ ÿßŸÑŸäŸàŸÖŸä',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'ÿ™ÿπŸÑŸÖ ŸàÿµŸÅ ÿ±Ÿàÿ™ŸäŸÜŸÉ ÿßŸÑŸäŸàŸÖŸä'
          },
          {
            'id': 'shopping',
            'title': 'ÿßŸÑÿ™ÿ≥ŸàŸÇ',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ ŸàÿßŸÑÿ™ÿπÿ®Ÿäÿ±ÿßÿ™ ŸÑŸÑÿ™ÿ≥ŸàŸÇ'
          },
          {
            'id': 'hobbies',
            'title': 'ÿßŸÑŸáŸàÿßŸäÿßÿ™ ŸàŸàŸÇÿ™ ÿßŸÑŸÅÿ±ÿßÿ∫',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'ÿßŸÑÿ™ÿ≠ÿØÿ´ ÿπŸÜ ŸáŸàÿßŸäÿßÿ™ŸÉ Ÿàÿ£ŸÜÿ¥ÿ∑ÿ™ŸÉ'
          }
        ],
        'it': [
          {
            'id': 'routine',
            'title': 'Routine quotidiana',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Imparare a descrivere la routine quotidiana'
          },
          {
            'id': 'shopping',
            'title': 'Fare la spesa',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Vocabolario ed espressioni per lo shopping'
          },
          {
            'id': 'hobbies',
            'title': 'Hobby e tempo libero',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Parlare dei tuoi hobby e attivit√†'
          }
        ],
        'de': [
          {
            'id': 'routine',
            'title': 'Tagesablauf',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Lernen Sie Ihren Tagesablauf zu beschreiben'
          },
          {
            'id': 'shopping',
            'title': 'Einkaufen',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Vokabeln und Ausdr√ºcke zum Einkaufen'
          },
          {
            'id': 'hobbies',
            'title': 'Hobbys und Freizeit',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': '√úber Ihre Hobbys und Aktivit√§ten sprechen'
          }
        ]
      },
      'travel': {
        'fr': [
          {
            'id': 'transport',
            'title': 'Transports en commun',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Se d√©placer en ville'
          },
          {
            'id': 'hotel',
            'title': '√Ä l\'h√¥tel',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'R√©server une chambre et services'
          },
          {
            'id': 'directions',
            'title': 'Demander son chemin',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'S\'orienter et donner des directions'
          }
        ],
        'en': [
          {
            'id': 'transport',
            'title': 'Public Transportation',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Getting around the city'
          },
          {
            'id': 'hotel',
            'title': 'At the Hotel',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Booking a room and services'
          },
          {
            'id': 'directions',
            'title': 'Asking for Directions',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Navigate and give directions'
          }
        ],
        'ar': [
          {
            'id': 'transport',
            'title': 'Ÿàÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜŸÇŸÑ ÿßŸÑÿπÿßŸÖ',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'ÿßŸÑÿ™ŸÜŸÇŸÑ ŸÅŸä ÿßŸÑŸÖÿØŸäŸÜÿ©'
          },
          {
            'id': 'hotel',
            'title': 'ŸÅŸä ÿßŸÑŸÅŸÜÿØŸÇ',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'ÿ≠ÿ¨ÿ≤ ÿ∫ÿ±ŸÅÿ© ŸàÿßŸÑÿÆÿØŸÖÿßÿ™'
          },
          {
            'id': 'directions',
            'title': 'ÿ∑ŸÑÿ® ÿßŸÑÿßÿ™ÿ¨ÿßŸáÿßÿ™',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'ÿßŸÑÿ™ŸÜŸÇŸÑ Ÿàÿ•ÿπÿ∑ÿßÿ° ÿßŸÑÿßÿ™ÿ¨ÿßŸáÿßÿ™'
          }
        ],
        'it': [
          {
            'id': 'transport',
            'title': 'Trasporti pubblici',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'Muoversi in citt√†'
          },
          {
            'id': 'hotel',
            'title': 'In albergo',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Prenotare una camera e servizi'
          },
          {
            'id': 'directions',
            'title': 'Chiedere indicazioni',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Orientarsi e dare indicazioni'
          }
        ],
        'de': [
          {
            'id': 'transport',
            'title': '√ñffentliche Verkehrsmittel',
            'duration': 30,
            'xp': 35,
            'level': 'A2',
            'content': 'In der Stadt unterwegs'
          },
          {
            'id': 'hotel',
            'title': 'Im Hotel',
            'duration': 25,
            'xp': 30,
            'level': 'A1',
            'content': 'Ein Zimmer und Services buchen'
          },
          {
            'id': 'directions',
            'title': 'Nach dem Weg fragen',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Sich orientieren und Wegbeschreibungen geben'
          }
        ]
      },
      'grammar': {
        'fr': [
          {
            'id': 'verbs',
            'title': 'Les verbes essentiels',
            'duration': 30,
            'xp': 35,
            'level': 'A1',
            'content': 'Conjugaison des verbes de base'
          },
          {
            'id': 'tenses',
            'title': 'Les temps verbaux',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Pr√©sent, pass√©, futur'
          },
          {
            'id': 'advanced',
            'title': 'Grammaire avanc√©e',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Subjonctif et conditionnel'
          }
        ],
        'en': [
          {
            'id': 'verbs',
            'title': 'Essential Verbs',
            'duration': 30,
            'xp': 35,
            'level': 'A1',
            'content': 'Basic verb conjugation'
          },
          {
            'id': 'tenses',
            'title': 'Verb Tenses',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Present, past, future'
          },
          {
            'id': 'advanced',
            'title': 'Advanced Grammar',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Complex structures and conditionals'
          }
        ],
        'ar': [
          {
            'id': 'verbs',
            'title': 'ÿßŸÑÿ£ŸÅÿπÿßŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©',
            'duration': 30,
            'xp': 35,
            'level': 'A1',
            'content': 'ÿ™ÿµÿ±ŸäŸÅ ÿßŸÑÿ£ŸÅÿπÿßŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©'
          },
          {
            'id': 'tenses',
            'title': 'ÿßŸÑÿ£ÿ≤ŸÖŸÜÿ©',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'ÿßŸÑŸÖÿßÿ∂Ÿä ŸàÿßŸÑŸÖÿ∂ÿßÿ±ÿπ ŸàÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ'
          },
          {
            'id': 'advanced',
            'title': 'ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'ÿßŸÑÿ™ÿ±ÿßŸÉŸäÿ® ÿßŸÑŸÖÿπŸÇÿØÿ© ŸàÿßŸÑÿ¥ÿ±ÿ∑'
          }
        ],
        'it': [
          {
            'id': 'verbs',
            'title': 'Verbi essenziali',
            'duration': 30,
            'xp': 35,
            'level': 'A1',
            'content': 'Coniugazione dei verbi di base'
          },
          {
            'id': 'tenses',
            'title': 'Tempi verbali',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Presente, passato, futuro'
          },
          {
            'id': 'advanced',
            'title': 'Grammatica avanzata',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Congiuntivo e condizionale'
          }
        ],
        'de': [
          {
            'id': 'verbs',
            'title': 'Grundlegende Verben',
            'duration': 30,
            'xp': 35,
            'level': 'A1',
            'content': 'Konjugation der Grundverben'
          },
          {
            'id': 'tenses',
            'title': 'Zeitformen',
            'duration': 35,
            'xp': 40,
            'level': 'B1',
            'content': 'Pr√§sens, Vergangenheit, Zukunft'
          },
          {
            'id': 'advanced',
            'title': 'Fortgeschrittene Grammatik',
            'duration': 40,
            'xp': 45,
            'level': 'B2',
            'content': 'Konjunktiv und Konditional'
          }
        ]
      },
      'skills': {
        'fr': [
          {
            'id': 'reading',
            'name': 'Lecture',
            'icon': 'menu_book',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'read_basic',
                'title': 'Lecture de base',
                'level': 'A1',
                'xp': 20,
                'type': 'text_comprehension',
                'content': 'Un texte simple sur la vie quotidienne',
                'questions': [
                  {
                    'question': 'De quoi parle le texte ?',
                    'options': [
                      'La famille',
                      'Le travail',
                      'Les loisirs',
                      'La maison'
                    ],
                    'correct': 0
                  }
                ]
              },
              {
                'id': 'read_intermediate',
                'title': 'Lecture interm√©diaire',
                'level': 'A2',
                'xp': 30,
                'type': 'text_comprehension',
                'content': 'Un article sur la culture fran√ßaise',
                'questions': [
                  {
                    'question': 'Quel est le th√®me principal ?',
                    'options': [
                      'La gastronomie',
                      'L\'art',
                      'La mode',
                      'Le cin√©ma'
                    ],
                    'correct': 1
                  }
                ]
              },
              {
                'id': 'read_advanced',
                'title': 'Lecture avanc√©e',
                'level': 'B1',
                'xp': 40,
                'type': 'text_analysis',
                'content': 'Un extrait de litt√©rature fran√ßaise',
                'questions': [
                  {
                    'question': 'Analysez le style de l\'auteur',
                    'type': 'open_ended'
                  }
                ]
              }
            ]
          },
          {
            'id': 'writing',
            'name': '√âcriture',
            'icon': 'edit',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'write_basic',
                'title': '√âcriture de base',
                'level': 'A1',
                'xp': 20,
                'type': 'sentence_completion',
                'prompts': ['Je m\'appelle...', 'J\'habite √†...', 'J\'aime...']
              },
              {
                'id': 'write_intermediate',
                'title': '√âcriture interm√©diaire',
                'level': 'A2',
                'xp': 30,
                'type': 'short_essay',
                'prompt': 'D√©crivez votre journ√©e type',
                'minWords': 50,
                'maxWords': 100
              },
              {
                'id': 'write_advanced',
                'title': '√âcriture avanc√©e',
                'level': 'B1',
                'xp': 40,
                'type': 'essay',
                'prompt': 'R√©digez un article d\'opinion',
                'minWords': 150,
                'maxWords': 300
              }
            ]
          },
          {
            'id': 'listening',
            'name': '√âcoute',
            'icon': 'headphones',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'listen_basic',
                'title': '√âcoute de base',
                'level': 'A1',
                'xp': 20,
                'type': 'audio_comprehension',
                'audioUrl': 'basic_dialogue.mp3',
                'questions': [
                  {
                    'question': 'Que disent les personnages ?',
                    'options': [
                      'Bonjour',
                      'Au revoir',
                      'Merci',
                      'S\'il vous pla√Æt'
                    ],
                    'correct': 0
                  }
                ]
              },
              {
                'id': 'listen_intermediate',
                'title': '√âcoute interm√©diaire',
                'level': 'A2',
                'xp': 30,
                'type': 'audio_dictation',
                'audioUrl': 'intermediate_dialogue.mp3',
                'transcript': 'Transcription du dialogue'
              },
              {
                'id': 'listen_advanced',
                'title': '√âcoute avanc√©e',
                'level': 'B1',
                'xp': 40,
                'type': 'audio_analysis',
                'audioUrl': 'advanced_dialogue.mp3',
                'tasks': [
                  'Identifiez les accents r√©gionaux',
                  'Rep√©rez les expressions idiomatiques',
                  'Analysez le registre de langue'
                ]
              }
            ]
          },
          {
            'id': 'speaking',
            'name': 'Expression orale',
            'icon': 'mic',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'speak_basic',
                'title': 'Expression orale de base',
                'level': 'A1',
                'xp': 20,
                'type': 'pronunciation',
                'words': ['Bonjour', 'Merci', 'Au revoir'],
                'phonetics': ['b…îÃÉ. íu Å', 'm…õ Å.si', 'o. Å…ô.vwa Å']
              },
              {
                'id': 'speak_intermediate',
                'title': 'Expression orale interm√©diaire',
                'level': 'A2',
                'xp': 30,
                'type': 'dialogue_simulation',
                'scenarios': ['Au restaurant', '√Ä la gare', 'Dans un magasin']
              },
              {
                'id': 'speak_advanced',
                'title': 'Expression orale avanc√©e',
                'level': 'B1',
                'xp': 40,
                'type': 'presentation',
                'topics': [
                  'Votre ville natale',
                  'Un sujet d\'actualit√©',
                  'Votre passion'
                ],
                'duration': '3-5 minutes'
              }
            ]
          }
        ],
        'en': [
          {
            'id': 'reading',
            'name': 'Reading',
            'icon': 'menu_book',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'read_basic',
                'title': 'Basic Reading',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'read_intermediate',
                'title': 'Intermediate Reading',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'writing',
            'name': 'Writing',
            'icon': 'edit',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'write_basic',
                'title': 'Basic Writing',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'write_intermediate',
                'title': 'Intermediate Writing',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'listening',
            'name': 'Listening',
            'icon': 'headphones',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'listen_basic',
                'title': 'Basic Listening',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'listen_intermediate',
                'title': 'Intermediate Listening',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'speaking',
            'name': 'Speaking',
            'icon': 'mic',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'speak_basic',
                'title': 'Basic Speaking',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'speak_intermediate',
                'title': 'Intermediate Speaking',
                'level': 'A2',
                'xp': 30
              }
            ]
          }
        ],
        'ar': [
          {
            'id': 'reading',
            'name': 'ÿßŸÑŸÇÿ±ÿßÿ°ÿ©',
            'icon': 'menu_book',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'read_basic',
                'title': 'ÿßŸÑŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'read_intermediate',
                'title': 'ÿßŸÑŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ©',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'writing',
            'name': 'ÿßŸÑŸÉÿ™ÿßÿ®ÿ©',
            'icon': 'edit',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'write_basic',
                'title': 'ÿßŸÑŸÉÿ™ÿßÿ®ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'write_intermediate',
                'title': 'ÿßŸÑŸÉÿ™ÿßÿ®ÿ© ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ©',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'listening',
            'name': 'ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ',
            'icon': 'headphones',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'listen_basic',
                'title': 'ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'listen_intermediate',
                'title': 'ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'speaking',
            'name': 'ÿßŸÑÿ™ÿ≠ÿØÿ´',
            'icon': 'mic',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'speak_basic',
                'title': 'ÿßŸÑÿ™ÿ≠ÿØÿ´ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'speak_intermediate',
                'title': 'ÿßŸÑÿ™ÿ≠ÿØÿ´ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑',
                'level': 'A2',
                'xp': 30
              }
            ]
          }
        ],
        'it': [
          {
            'id': 'reading',
            'name': 'Lettura',
            'icon': 'menu_book',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'read_basic',
                'title': 'Lettura base',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'read_intermediate',
                'title': 'Lettura intermedia',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'writing',
            'name': 'Scrittura',
            'icon': 'edit',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'write_basic',
                'title': 'Scrittura base',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'write_intermediate',
                'title': 'Scrittura intermedia',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'listening',
            'name': 'Ascolto',
            'icon': 'headphones',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'listen_basic',
                'title': 'Ascolto base',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'listen_intermediate',
                'title': 'Ascolto intermedio',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'speaking',
            'name': 'Conversazione',
            'icon': 'mic',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'speak_basic',
                'title': 'Conversazione base',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'speak_intermediate',
                'title': 'Conversazione intermedia',
                'level': 'A2',
                'xp': 30
              }
            ]
          }
        ],
        'de': [
          {
            'id': 'reading',
            'name': 'Lesen',
            'icon': 'menu_book',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'read_basic',
                'title': 'Grundlegendes Lesen',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'read_intermediate',
                'title': 'Mittelstufe Lesen',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'writing',
            'name': 'Schreiben',
            'icon': 'edit',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'write_basic',
                'title': 'Grundlegendes Schreiben',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'write_intermediate',
                'title': 'Mittelstufe Schreiben',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'listening',
            'name': 'H√∂ren',
            'icon': 'headphones',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'listen_basic',
                'title': 'Grundlegendes H√∂ren',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'listen_intermediate',
                'title': 'Mittelstufe H√∂ren',
                'level': 'A2',
                'xp': 30
              }
            ]
          },
          {
            'id': 'speaking',
            'name': 'Sprechen',
            'icon': 'mic',
            'progress': 0.0,
            'exercises': [
              {
                'id': 'speak_basic',
                'title': 'Grundlegendes Sprechen',
                'level': 'A1',
                'xp': 20
              },
              {
                'id': 'speak_intermediate',
                'title': 'Mittelstufe Sprechen',
                'level': 'A2',
                'xp': 30
              }
            ]
          }
        ]
      }
    };

    // Si la langue ou la cat√©gorie n'existe pas, retourner une liste vide
    if (!lessonsPerCategory.containsKey(categoryId) ||
        !lessonsPerCategory[categoryId]!.containsKey(langId)) {
      return [];
    }

    return lessonsPerCategory[categoryId]![langId]!;
  }

  // Mettre √† jour une langue
  Future<void> updateLanguage(
      String languageId, Map<String, dynamic> data) async {
    await _firestore.collection('languages').doc(languageId).update(data);
  }

  // Supprimer une langue
  Future<void> deleteLanguage(String languageId) async {
    await _firestore.collection('languages').doc(languageId).delete();
  }

  Future<List<Map<String, dynamic>>> getThemes(String languageId) async {
    final themesSnapshot = await _firestore
        .collection('languages')
        .doc(languageId)
        .collection('themes')
        .get();
    return themesSnapshot.docs.map((doc) => doc.data()).toList();
  }

  Future<List<Map<String, dynamic>>> getSkills(String languageId) async {
    final snapshot = await _firestore
        .collection('languages')
        .doc(languageId)
        .collection('skills')
        .get();
    return snapshot.docs.map((doc) => {'id': doc.id, ...doc.data()}).toList();
  }

  // M√©thodes pour les langues
  Stream<DocumentSnapshot> getLanguageStream(String languageId) {
    return _firestore.collection('languages').doc(languageId).snapshots();
  }

  // M√©thodes pour les th√®mes
  Stream<QuerySnapshot> getThemesStream(String languageId) {
    return _firestore
        .collection('languages')
        .doc(languageId)
        .collection('themes')
        .orderBy('order')
        .snapshots();
  }

  Future<void> updateThemeProgress(
      String languageId, String themeId, double progress) {
    return _firestore
        .collection('languages')
        .doc(languageId)
        .collection('themes')
        .doc(themeId)
        .update({'progress': progress});
  }

  // M√©thodes pour les comp√©tences
  Stream<QuerySnapshot> getSkillsStream(String languageId) {
    return _firestore
        .collection('languages')
        .doc(languageId)
        .collection('skills')
        .orderBy('order')
        .snapshots();
  }

  Future<void> updateSkillProgress(
      String languageId, String skillId, double progress) {
    return _firestore
        .collection('languages')
        .doc(languageId)
        .collection('skills')
        .doc(skillId)
        .update({'progress': progress});
  }

  // M√©thode d'initialisation des donn√©es (√† utiliser une seule fois)
  Future<void> initializeLanguageData(
      String languageId, Map<String, dynamic> languageData) async {
    final languageRef = _firestore.collection('languages').doc(languageId);

    // Cr√©er ou mettre √† jour la langue
    await languageRef.set(languageData);

    // Initialiser les th√®mes par d√©faut
    final themesCollection = languageRef.collection('themes');
    final defaultThemes = [
      {
        'title': 'Bases',
        'description': 'Apprenez les fondamentaux',
        'iconCodePoint': 0xe88e, // school
        'order': 0,
        'progress': 0.0,
      },
      {
        'title': 'Vie quotidienne',
        'description': 'Conversations de tous les jours',
        'iconCodePoint': 0xe7fb, // people
        'order': 1,
        'progress': 0.0,
      },
      {
        'title': 'Culture',
        'description': 'D√©couvrez la culture',
        'iconCodePoint': 0xe55b, // museum
        'order': 2,
        'progress': 0.0,
      },
    ];

    for (final theme in defaultThemes) {
      await themesCollection.add(theme);
    }

    // Initialiser les comp√©tences par d√©faut
    final skillsCollection = languageRef.collection('skills');
    final defaultSkills = [
      {
        'name': '√âcoute',
        'iconCodePoint': 0xe3a1, // headphones
        'order': 0,
        'progress': 0.0,
      },
      {
        'name': 'Lecture',
        'iconCodePoint': 0xe865, // book
        'order': 1,
        'progress': 0.0,
      },
      {
        'name': '√âcriture',
        'iconCodePoint': 0xe3c9, // edit
        'order': 2,
        'progress': 0.0,
      },
      {
        'name': 'Prononciation',
        'iconCodePoint': 0xe029, // mic
        'order': 3,
        'progress': 0.0,
      },
    ];

    for (final skill in defaultSkills) {
      await skillsCollection.add(skill);
    }
  }
}
